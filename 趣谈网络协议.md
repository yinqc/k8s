## 第1讲 为什么要学网络协议

网络协议 - 互联互通

语法，语义，顺序



DNS、HTTP、HTTPS所在的层称为**应用层**。经过应用层的封装，浏览器会将应用层的包交给下一层去完成，通过socket套接口编程来实现。下一层是**传输层**。传输层有两种协议，一种是无连接的协议**UDP**，一种是面向连接的协议**TCP**。TCP协议里会有两个端口，source 和 target。传输层封装完毕后，浏览器会将包交给操作系统的**网络层**。网络层的协议是IP协议，source IP和target IP。**MAC层**，ARP协议。网关收到包之后，判断下一步怎么走。网关往往是个路由器，有路由表。路由协议，常用的有OSPF和BGP。

![image-20220920233137520](/Users/yinqc/Library/Application Support/typora-user-images/image-20220920233137520.png)

当网络包到达下一跳的时候，可以通过路由表得到下一跳的IP地址，直接通过IP地址找就可以了，为什么还要通过本地的MAC地址呢？

答：MAC地址是唯一的。





## 第2讲 网络分层的真实含义是什么

网络为什么要分层？

复杂的程序都要分层，这是程序设计的要 求。

这里要记住一点:只要是在网络上跑的包，都 是完整的。可以有下层没上层，绝对不可能有 上层没下层。

计算机科学领域的任何问题都可以增加一个间接的中间层来解决，计算机整个体系从上到下都是按照严格的层次结构设计的。



## 第3讲 ifconfig

ipconfig

ifconfig --- ip addr 

net-tools --- iproute2



![image-20220920235302159](/Users/yinqc/Library/Application Support/typora-user-images/image-20220920235302159.png)



![image-20220920235532155](/Users/yinqc/Library/Application Support/typora-user-images/image-20220920235532155.png)

IP 地址、网络号和主机号、ABC三类、ip地址可分配问题、子网掩码、子网划分

https://zhuanlan.zhihu.com/p/518657877

- 网络地址(全0) 和广播地址(全1) 不可分配。

  

无类型域间选路（CIDR）

CIDR（无类型域间选路，Classless Inter-Domain Routing）是一个在Internet上创建附加地址的方法，这些地址提供给服务提供商（ISP），再由ISP分配给客户。CIDR将路由集中起来， 使一个IP地址代表主要骨干提供商服务的几千个IP地址，从而减轻Internet[路由器](https://so.csdn.net/so/search?q=路由器&spm=1001.2101.3001.7020)的负担。

伴随着CIDR存在的，一个是广播地址，另一个是子网掩码



D类地址，组播地址，VXLAN



MAC地址 身份证号；IP地址 门牌号

网络设备的状态标识 （net_device flags）





## 第4讲 DHCP与PXE



DHCP 协议主要是用来给客户租用 IP 地 址，和房产中介很像，要商谈、签约、续 租，广播还不能“抢单”;

DHCP 协议能给客户推荐“装修队”PXE， 能够安装操作系统，这个在云计算领域大有用处。

PXE预启动执行环境





## 第5讲 从物理层到MAC层

第一层，物理层



第二层，数据链路层

MAC，Medium Access Control

1. 这个包是发给谁的?谁应该接收?
   链路层地址
   网络包格式、内容
   ARP协议，知IP地址求MAC地址；ARP广播包，ARP缓存
2. 大家都在发，会不会产生混乱?有没有谁先发、谁后发的规则?
   多路访问：信道划分，轮流协议，随机接入协议
3. 如果发送的时候出现了错误，怎么办?
   对于以太网，第二层的最后面是CRC，循环冗余检测

交换机，交换机学习的结果称为转发表



RARP协议是许多无盘系统在引导时用来获取 I P地址的





## 第6讲 交换机与LAN



STP Spanning Tree Protocol

VLAN



## 第7讲 ICMP与ping

ping 是基于 ICMP 协议工作的。ICMP 全称 Internet Control Message Protocol，就是 互联网控制报文协议。这里面的关键词是“控 制”，那具体是怎么控制的呢?



如果在自己的可控范围之内，当遇到网络不通 的问题的时候，除了直接 ping 目标的 IP 地 址之外，还应该有一个清晰的网络拓扑图。并 且从理论上来讲，应该要清楚地知道一个网络 包从源地址到目标地址都需要经过哪些设备， 然后逐个 ping 中间的这些设备或者机器。如 果可能的话，在这些关键点，通过 tcpdump -i eth0 icmp，查看包有没有到达某个点，回 复的包到达了哪个点，可以更加容易推断出错 的位置。



这个时候就要使 用 telnet，通过其他协议来测试网络是否通， 这个就不在本篇的讲述范围了。



ICMP 相当于网络世界的侦察兵。我讲了两 种类型的 ICMP 报文，一种是主动探查的 查询报文，一种异常报告的差错报文;

ping 使用查询报文，Traceroute 使用差错 报文。



## 第8讲 出网关

网关往往是一个路由器，是一个三层转发的设备。啥叫三层设备?前面也说过了，就是把 MAC 头和 IP 头都取下来，然后根据里面的 内容，看看接下来把包往哪里转发的设备。

很多情况下，人们把网关就叫做路由器。其实 不完全准确，而另一种比喻更加恰当:路由器 是一台设备，它有五个网口或者网卡，相当于 有五只手，分别连着五个局域网。每只手的 IP 地址都和局域网的 IP 地址相同的网段，每 只手都是它握住的那个局域网的网关。



静态路由，其实就是在路由器上，配置一条一 条规则。

MAC 地址是一个局域网内才有 效的地址。因而，MAC 地址只要过网关，就 必定会改变，因为已经换了局域网。



不改变 IP 地址 的网关，我们称为转发网关;改变 IP 地址的 网关，我们称为NAT 网关。

